# Система формы 052/у - Медицинская карта амбулаторного пациента

## Обзор

Реализована полноценная система ведения медицинских карт формы 052/у для профессиональных осмотров с возможностью генерации итогового документа.

## Основные компоненты

### 1. Типы данных (types.ts)

#### AmbulatoryCard
Расширенная структура амбулаторной карты включает:
- **Паспортная часть** - ФИО, дата рождения, адрес, место работы, вредные факторы
- **Анамнез** - хронические заболевания, аллергии, вредные привычки, наследственность
- **Антропометрия** - рост, вес, ИМТ, АД, пульс
- **Лабораторные исследования** - анализы крови, мочи, ЭКГ, флюорография
- **Осмотры врачей** - записи всех специалистов
- **Финальное заключение** - итоговое решение комиссии

#### DoctorExamination
Структура осмотра врача:
- Жалобы пациента
- Объективный осмотр
- Диагноз
- Заключение
- Рекомендации
- Годность к работе

### 2. Компоненты

#### DoctorDashboard (components/DoctorDashboard.tsx)
Личный кабинет врача для проведения осмотров:
- Маршрутный лист с сотрудниками
- Форма заполнения осмотра (жалобы, осмотр, диагноз, заключение)
- Для профпатолога: кнопки выставления финального заключения

#### FinalConclusionModal (components/FinalConclusionModal.tsx)
Модальное окно для председателя комиссии (профпатолога):
- Выставление финального статуса (годен/не годен/наблюдение)
- Диагноз и рекомендации
- Ограничения к работе
- Дата следующего осмотра
- Доступно только после завершения всех осмотров

#### AmbulatoryCardView (components/AmbulatoryCardView.tsx)
Компонент просмотра амбулаторной карты:
- Отображение всех разделов карты
- Прогресс осмотров
- Кнопка печати формы 052/у

#### EmployeeDashboard (components/EmployeeDashboard.tsx)
Личный кабинет сотрудника:
- Просмотр своей амбулаторной карты
- Маршрутный лист с назначенными врачами
- Результаты осмотров
- Финальное заключение

### 3. Генерация документов

#### form052Generator.ts (utils/form052Generator.ts)
Генератор HTML-документа формы 052/у:
- `generateForm052HTML()` - создание HTML с полной структурой формы
- `printForm052()` - открытие окна печати
- Форматирование для печати на A4
- Профессиональный дизайн документа

## Рабочий процесс

### 1. Создание амбулаторной карты
Карта создается автоматически при первом осмотре врача:
```typescript
{
  employeeId: string,
  contractId: string,
  cardNumber: "052/D-2024-001/emp123",
  personalInfo: { ... },
  examinations: {},
  createdAt: timestamp
}
```

### 2. Осмотры врачей
Каждый врач заполняет свою часть:
1. Открывает маршрутный лист
2. Выбирает сотрудника
3. Заполняет форму осмотра:
   - Жалобы
   - Объективный осмотр
   - Диагноз
   - Заключение
   - Рекомендации
   - Годность к работе
4. Сохраняет осмотр

### 3. Финальное заключение (Профпатолог)
После завершения всех осмотров:
1. Профпатолог видит кнопку "Выставить заключение"
2. Открывается модальное окно
3. Заполняет:
   - Статус (годен/не годен/наблюдение)
   - Диагноз
   - Рекомендации
   - Ограничения
   - Дата следующего осмотра
4. Сохраняет заключение

### 4. Получение документа
Сотрудник или врач может:
1. Открыть амбулаторную карту
2. Нажать кнопку "Печать формы 052/у"
3. Получить готовый документ для печати

## База данных Firebase

### Структура данных

```
ambulatoryCards/
  {employeeId}_{contractId}/
    cardNumber: "052/..."
    personalInfo: { ... }
    anamnesis: { ... }
    vitals: { ... }
    labTests: { ... }
    examinations:
      "Терапевт":
        doctorId: "..."
        status: "completed"
        complaints: "..."
        diagnosis: "..."
        ...
      "Невролог": { ... }
    finalConclusion:
      status: "fit"
      date: "..."
      doctorId: "..."
      diagnosis: "..."
      ...
    createdAt: "..."
    updatedAt: "..."
```

## Особенности реализации

### 1. Автоматическое создание карты
При первом осмотре карта создается с базовой информацией из профиля сотрудника.

### 2. Валидация финального заключения
Профпатолог может выставить заключение только после завершения всех осмотров.

### 3. Обновление статуса сотрудника
При выставлении финального заключения автоматически обновляется статус сотрудника в договоре.

### 4. Печать документа
Генерируется полноценный HTML-документ с:
- Правильным форматированием для A4
- Всеми разделами формы 052/у
- Подписями и печатями
- Профессиональным дизайном

## Расширение функционала

### Добавление новых полей в анамнез
```typescript
// В types.ts
anamnesis?: {
  chronicDiseases?: string;
  pastDiseases?: string;
  allergies?: string;
  badHabits?: string;
  heredity?: string;
  occupationalHistory?: string;
  // Добавить новое поле:
  newField?: string;
}
```

### Добавление лабораторных исследований
```typescript
// В types.ts
labTests?: {
  bloodTest?: LabTestResult;
  biochemistry?: LabTestResult;
  urineTest?: LabTestResult;
  ecg?: LabTestResult;
  fluorography?: LabTestResult;
  // Добавить новое исследование:
  newTest?: LabTestResult;
  other?: LabTestResult[];
}
```

### Кастомизация генератора PDF
Отредактируйте `utils/form052Generator.ts`:
- Измените стили CSS
- Добавьте новые разделы
- Настройте форматирование

## Безопасность

- Все данные хранятся в Firebase Realtime Database
- Доступ к картам только для авторизованных пользователей
- Врачи видят только своих пациентов
- Сотрудники видят только свою карту

## Поддержка

При возникновении проблем проверьте:
1. Правила безопасности Firebase
2. Структуру данных в базе
3. Консоль браузера на наличие ошибок
4. Логи в консоли разработчика

## Будущие улучшения

- [ ] Экспорт в PDF (не только печать)
- [ ] Электронная подпись врачей
- [ ] Загрузка файлов (результаты анализов)
- [ ] История изменений карты
- [ ] Уведомления о завершении осмотров
- [ ] Статистика и отчеты
- [ ] Интеграция с медицинскими системами
