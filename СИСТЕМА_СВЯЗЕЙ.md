# Система электронных связей MedFlow

## Обзор

Полностью электронная система медицинских осмотров с реальным временем синхронизации между всеми участниками:
- **Регистратура** - управление посещениями, выдача документов
- **Врачи** - проведение осмотров, заполнение карт
- **Сотрудники** - просмотр своих данных и прогресса

## Архитектура связей

### 1. Регистратура ↔ Врачи

**Регистратура → Врачи:**
- Уведомление о новом пациенте в очереди
- Обновление маршрутного листа
- Изменение статуса посещения

**Врачи → Регистратура:**
- Завершение осмотра
- Обновление амбулаторной карты
- Финальное заключение

### 2. Регистратура ↔ Сотрудники

**Регистратура → Сотрудники:**
- Регистрация входа/выхода
- Выдача документов (маршрутный лист, направления)
- Обновление маршрута осмотра

**Сотрудники → Регистратура:**
- Запрос информации о статусе
- Просмотр выданных документов

### 3. Врачи ↔ Сотрудники

**Врачи → Сотрудники:**
- Завершение осмотра у специалиста
- Внесение данных в амбулаторную карту
- Рекомендации и заключения

**Сотрудники → Врачи:**
- Доступ к истории осмотров
- Просмотр заключений

## Технологии

### Frontend

1. **React + TypeScript** - основной фреймворк
2. **Tailwind CSS** - стилизация
3. **Custom Hooks** - управление состоянием

### Backend

1. **Go** - высокопроизводительный API сервер
2. **PostgreSQL** - база данных с оптимизированными индексами
3. **WebSocket** - реальное время (готово к подключению)

### Оптимизация

1. **Кэширование** - `apiCache` для часто запрашиваемых данных
2. **Виртуализация списков** - для работы с большими объемами данных
3. **Дебаунсинг/Throttling** - оптимизация поисковых запросов
4. **Батчинг** - группировка запросов к API

## Использование

### Система уведомлений

```typescript
import { notificationService } from './services/notificationService';

// Отправка уведомления
await notificationService.notifyVisitRegistered(
  employeeId,
  employeeName,
  doctorId,
  registrarName,
  visitData
);

// Подписка на уведомления
const unsubscribe = notificationService.subscribe(userId, (notification) => {
  console.log('Новое уведомление:', notification);
});
```

### WebSocket (реальное время)

```typescript
import { websocketService } from './services/websocketService';

// Подключение
websocketService.connect(userId);

// Подписка на события
const unsubscribe = websocketService.on('examination_completed', (message) => {
  console.log('Осмотр завершен:', message.data);
  // Обновить UI
});

// Отправка события
websocketService.send({
  type: 'visit_created',
  data: visitData,
  timestamp: new Date().toISOString(),
});
```

### Компонент уведомлений

```typescript
import NotificationPanel from './components/NotificationPanel';

<NotificationPanel 
  userId={currentUser.uid} 
  userRole={currentUser.role} 
/>
```

### Оптимизация API

```typescript
import { apiCache, debounce, paginateArray } from './services/apiOptimization';

// Кэширование
const cached = apiCache.get('contracts_list');
if (!cached) {
  const data = await apiListContracts();
  apiCache.set('contracts_list', data, 5 * 60 * 1000); // 5 минут
}

// Дебаунсинг поиска
const debouncedSearch = debounce(async (query) => {
  const results = await apiSearch(query);
  setResults(results);
}, 300);

// Пагинация
const paginated = paginateArray(largeArray, {
  page: 1,
  pageSize: 50,
});
```

## UI/UX Особенности

### Минималистичный дизайн

- Градиентные фоны и карточки
- Мягкие тени и скругления
- Анимации переходов
- Backdrop blur эффекты

### Адаптивность

- Полностью responsive дизайн
- Оптимизация для планшетов и мобильных
- Touch-friendly интерфейс

### Производительность

- Виртуализация длинных списков
- Ленивая загрузка изображений
- Оптимизированный рендеринг
- Мемоизация вычислений

### Доступность

- Семантический HTML
- ARIA атрибуты
- Keyboard navigation
- Screen reader поддержка

## Workflow

### 1. Регистрация посещения

```
Сотрудник приходит → Регистратура → Создание посещения
                                  ↓
                     Уведомление врачам + сотруднику
                                  ↓
                     Генерация маршрутного листа
                                  ↓
                     Выдача документов сотруднику
```

### 2. Прохождение осмотра

```
Сотрудник у врача → Врач открывает карту
                                  ↓
                     Проведение осмотра
                                  ↓
                     Заполнение данных
                                  ↓
                     Сохранение → Уведомления всем
                                  ↓
                     Обновление маршрута
```

### 3. Завершение

```
Все осмотры пройдены → Финальное заключение
                                  ↓
                     Уведомление всем участникам
                                  ↓
                     Регистрация выхода
                                  ↓
                     Выдача итоговых документов
```

## Безопасность

1. **Аутентификация** - через телефон + OTP
2. **Авторизация** - ролевая модель доступа
3. **Шифрование** - HTTPS для всех запросов
4. **Валидация** - на клиенте и сервере

## Масштабируемость

1. **Горизонтальное масштабирование** - Go сервер поддерживает кластеризацию
2. **Пул соединений БД** - оптимизирован для высокой нагрузки
3. **Кэширование** - снижение нагрузки на БД
4. **CDN** - для статических ресурсов

## Мониторинг

```typescript
import { performanceMonitor } from './services/apiOptimization';

// Отслеживание производительности
const end = performanceMonitor.start('load_contracts');
await loadContracts();
end();

// Получение статистики
const stats = performanceMonitor.getStats('load_contracts');
console.log('Средняя загрузка:', stats.avg, 'мс');
```

## Развертывание

### Локальная разработка

```bash
# Frontend
npm install
npm run dev

# Backend
cd backend
go run main.go
```

### Продакшн

```bash
# Docker
docker-compose up -d

# Или через скрипт
./deploy.sh
```

## Поддержка

Для вопросов и предложений:
- Email: support@medflow.kz
- Документация: https://docs.medflow.kz
- GitHub: https://github.com/medflow/system

## Лицензия

Proprietary - все права защищены

