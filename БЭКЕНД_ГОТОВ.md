# ‚úÖ –ë—ç–∫–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤!

## üéØ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –±—ç–∫–µ–Ω–¥

### 1. –ü–æ–ª–µ `roomNumber` –≤ Doctor

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (main.go):
```go
type Doctor struct {
    ID         int64   `json:"id"`
    ClinicUID  string  `json:"clinicUid"`
    Name       string  `json:"name"`
    Specialty  string  `json:"specialty"`
    Phone      string  `json:"phone,omitempty"`
    IsChairman bool    `json:"isChairman"`
    RoomNumber *string `json:"roomNumber,omitempty"` // üÜï –ù–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞
}
```

#### –¢–∞–±–ª–∏—Ü–∞ –ë–î:
```sql
CREATE TABLE IF NOT EXISTS doctors (
  id           SERIAL PRIMARY KEY,
  clinic_uid   TEXT NOT NULL,
  name         TEXT NOT NULL,
  specialty    TEXT NOT NULL,
  phone        TEXT,
  is_chairman  BOOLEAN NOT NULL DEFAULT FALSE,
  room_number  TEXT  -- üÜï –ù–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞
);
```

#### API endpoints –æ–±–Ω–æ–≤–ª–µ–Ω—ã:
- ‚úÖ **GET** `/api/clinics/{clinicUid}/doctors` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `roomNumber`
- ‚úÖ **POST** `/api/clinics/{clinicUid}/doctors` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `roomNumber`
- ‚úÖ **PUT** `/api/clinics/{clinicUid}/doctors/{id}` - –æ–±–Ω–æ–≤–ª—è–µ—Ç `roomNumber`

### 2. –ü–æ–ª–µ `healthGroup` –≤ Employee

**–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î!**

Employees —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ JSON –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `contracts`, –ø–æ—ç—Ç–æ–º—É:
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω (`types.ts`)
- ‚úÖ –ë—ç–∫–µ–Ω–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π JSON
- ‚úÖ –ü–æ–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –ø—Ä–∏ UPDATE –¥–æ–≥–æ–≤–æ—Ä–∞

## üì¶ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: `backend/migration_add_room_number.sql`

### –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–π –ë–î PostgreSQL
psql -U postgres -d medflow -f backend/migration_add_room_number.sql

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker
docker exec -i postgres_container psql -U postgres -d medflow < backend/migration_add_room_number.sql
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∫–æ–ª–æ–Ω–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞
\d doctors

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Ä–∞—á–µ–π
SELECT id, name, specialty, room_number FROM doctors;
```

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞ ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Ä–∞—á–µ–π —Å `roomNumber`:
   ```typescript
   GET /api/clinics/{clinicUid}/doctors
   
   Response: [
     {
       "id": 1,
       "name": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
       "specialty": "–¢–µ—Ä–∞–ø–µ–≤—Ç",
       "roomNumber": "101"  // üÜï
     },
     ...
   ]
   ```

2. –°–æ–∑–¥–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –∫–∞–±–∏–Ω–µ—Ç–æ–≤:
   ```typescript
   routeItems: [
     {
       specialty: "–¢–µ—Ä–∞–ø–µ–≤—Ç",
       doctorName: "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
       roomNumber: "101"  // üÜï
     }
   ]
   ```

3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É

### –í—Ä–∞—á ‚Üí –§–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ

1. –í—Ä–∞—á –∑–∞–ø–æ–ª–Ω—è–µ—Ç –æ—Å–º–æ—Ç—Ä –≤ –∞–º–±—É–ª–∞—Ç–æ—Ä–Ω–æ–π –∫–∞—Ä—Ç–µ
2. –ü—Ä–æ—Ñ–ø–∞—Ç–æ–ª–æ–≥ –≤—ã–±–∏—Ä–∞–µ—Ç –≥—Ä—É–ø–ø—É –∑–¥–æ—Ä–æ–≤—å—è (I-V)
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ:
   ```typescript
   finalConclusion: {
     status: "fit",
     healthGroup: "II",  // üÜï
     diagnosis: "...",
     recommendations: "...",
     nextExamDate: "..."
   }
   ```

4. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ –¥–æ–≥–æ–≤–æ—Ä–µ:
   ```typescript
   employee: {
     ...
     status: "fit",
     healthGroup: "II"  // üÜï –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ JSON
   }
   ```

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### API endpoints:

#### –í—Ä–∞—á–∏:
- ‚úÖ GET `/api/clinics/{clinicUid}/doctors` - —Å `roomNumber`
- ‚úÖ POST `/api/clinics/{clinicUid}/doctors` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å `roomNumber`
- ‚úÖ PUT `/api/clinics/{clinicUid}/doctors/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `roomNumber`
- ‚úÖ DELETE `/api/clinics/{clinicUid}/doctors/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ

#### –î–æ–≥–æ–≤–æ—Ä—ã:
- ‚úÖ GET `/api/contracts?bin={bin}` - employees —Å `healthGroup`
- ‚úÖ PUT `/api/contracts/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ employees —Å `healthGroup`

#### –ê–º–±—É–ª–∞—Ç–æ—Ä–Ω—ã–µ –∫–∞—Ä—Ç—ã:
- ‚úÖ GET `/api/ambulatory-cards?employeeId={id}&contractId={id}` - —Å `healthGroup` –≤ finalConclusion
- ‚úÖ POST `/api/ambulatory-cards` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å `healthGroup`
- ‚úÖ PUT `/api/ambulatory-cards/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å `healthGroup`

#### –ü–æ—Å–µ—â–µ–Ω–∏—è:
- ‚úÖ GET `/api/employee-visits?clinicId={id}&date={date}` - —Ä–∞–±–æ—Ç–∞–µ—Ç!
- ‚úÖ POST `/api/employee-visits` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Ö–æ–¥–∞
- ‚úÖ PUT `/api/employee-visits/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

## üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

### –®–∞–≥ 1: –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–Ω–∞)

```bash
psql -U postgres -d medflow -f backend/migration_add_room_number.sql
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞

```bash
cd backend
go run main.go
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Docker:

```bash
docker-compose restart backend
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω
curl http://localhost:8080/api/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–∞—á–µ–π (—Å roomNumber)
curl http://localhost:8080/api/clinics/user_xxx/doctors
```

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∫–∞–±–∏–Ω–µ—Ç–∞ –≤—Ä–∞—á–∞:

```bash
curl -X PUT http://localhost:8080/api/clinics/user_xxx/doctors/1 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
    "specialty": "–¢–µ—Ä–∞–ø–µ–≤—Ç",
    "phone": "+77001234567",
    "isChairman": false,
    "roomNumber": "101"
  }'
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤—Ä–∞—á–∞ —Å –∫–∞–±–∏–Ω–µ—Ç–æ–º:

```bash
curl -X POST http://localhost:8080/api/clinics/user_xxx/doctors \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–ü–µ—Ç—Ä–æ–≤ –ü.–ü.",
    "specialty": "–û—Ñ—Ç–∞–ª—å–º–æ–ª–æ–≥",
    "phone": "+77007654321",
    "isChairman": false,
    "roomNumber": "205"
  }'
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ —Å –≥—Ä—É–ø–ø–æ–π –∑–¥–æ—Ä–æ–≤—å—è:

```bash
curl -X PUT http://localhost:8080/api/contracts/1 \
  -H "Content-Type: application/json" \
  -d '{
    "employees": [
      {
        "id": "emp_1",
        "name": "–°–∏–¥–æ—Ä–æ–≤ –°.–°.",
        "status": "fit",
        "healthGroup": "II"
      }
    ]
  }'
```

## üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–∞—á–µ–π:

```bash
curl http://localhost:8080/api/clinics/user_1766335016000/doctors | jq
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
[
  {
    "id": 1,
    "clinicUid": "user_1766335016000",
    "name": "–ò–≤–∞–Ω–æ–≤ –ò.–ò.",
    "specialty": "–¢–µ—Ä–∞–ø–µ–≤—Ç",
    "phone": "+77001234567",
    "isChairman": false,
    "roomNumber": "101"  ‚úÖ
  }
]
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏—è:

```bash
curl "http://localhost:8080/api/employee-visits?clinicId=user_1766335016000&date=2025-12-21" | jq
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: –º–∞—Å—Å–∏–≤ –∏–∑ 15 –ø–æ—Å–µ—â–µ–Ω–∏–π ‚úÖ

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä:

```bash
curl "http://localhost:8080/api/contracts?bin=123456789012" | jq
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ employees —Å–æ–¥–µ—Ä–∂–∞—Ç `healthGroup` (–µ—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ)

## ‚úÖ –ò—Ç–æ–≥

### –ë—ç–∫–µ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤:

- ‚úÖ –ü–æ–ª–µ `roomNumber` –≤ Doctor (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ë–î, API)
- ‚úÖ –ü–æ–ª–µ `healthGroup` –≤ Employee (—á–µ—Ä–µ–∑ JSON –≤ contracts)
- ‚úÖ –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ API –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:

1. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é** (–æ–¥–∏–Ω —Ä–∞–∑)
2. ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ç–∫–µ–Ω–¥**
3. ‚úÖ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥**

---

**–ë—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤! –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É!** üöÄ

